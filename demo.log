$ ./scripts/demo.sh
╔══════════════════════════════════════════════════════════════╗
║                    NFT DEX 功能演示                        ║
║                                                              ║
║  本演示将展示以下功能:                                      ║
║  • 启动本地 Anvil 节点                                     ║
║  • 部署 NFT 合约和 AMM 系统                               ║
║  • 演示 NFT 交易功能                                       ║
║  • 展示价格监控和池子管理                                 ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝

按 Enter 继续...

=== 步骤 1: 启动 Anvil 本地节点 ===
启动 Anvil 节点在 http://localhost:8545...
等待 Anvil 启动...
✅ Anvil 节点启动成功!
按 Enter 继续...

=== 步骤 2: 部署合约 ===
部署 AMM 系统 (NFT + AMM 合约)...
PRIVATE_KEY: 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
SENDER_ADDRESS: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
✅ 合约部署成功!
NFT 合约地址: 0x5FbDB2315678afecb367f032d93F642f64180aa3
AMM 合约地址: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512

=== 流动性添加完成 ===

=== LP Token 信息 ===
LP Token 地址: 0xcafac3dd18ac6c6e92c921884f9e4176737c052c
做市者地址: 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266
LP Token 总供应量: 14142135623
做市者持有: 14142135623
做市者持有比例: 100.00%
按 Enter 继续...

=== 步骤 3: 查询合约信息 ===
查询 AMM 合约信息...
获取当前价格...
当前价格: 500000000000000000 wei
当前价格: 0.500000000000000000 ETH
获取池子储备量...
ETH 储备: 10000000000000000000 wei
NFT 储备: 20
ETH 储备: 10.000000000000000000 ETH
获取交易费用...
交易费用: 200 basis points
获取累计收益...
累计收益: 0.000000000000000000 ETH
按 Enter 继续...

=== 步骤 4: 价格监控演示 ===
启动价格监控 (5秒后自动停止)...
按 Ctrl+C 可以提前停止
运行价格监控脚本...
=== NFT DEX 价格监控 ===
按 Ctrl+C 停止监控

合约地址: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
ETH 储备量: 9223372036854775807 wei (9.223372 ETH)
NFT 储备量: 20
当前买入价格: 500000000000000000 wei (.500000 ETH)
当前卖出价格: 476190476190476190 wei (.476190 ETH)
买入总成本: 510000000000000000 wei (.510000 ETH)
买入手续费: 10000000000000000 wei (.010000 ETH)
卖出净收入: 466666666666666667 wei (.466666 ETH)
卖出手续费: 9523809523809523 wei (.009523 ETH)

=== 池子收益信息 ===
累积交易费收益: 0 wei (0 ETH)
池子 ETH 余额: 10000000000000000000 wei (10.000000 ETH)
池子 ETH 储备: 10000000000000000000 wei (9.223372 ETH)
池子 NFT 储备: 20
累计手续费收益: 0 wei (0 ETH)
平均价格: .500000 ETH per NFT
=== NFT DEX 价格监控 ===
按 Ctrl+C 停止监控

按 Enter 继续...

监控已停止

=== 步骤 5: 交易功能演示 ===
查询当前价格信息...
当前价格: 0.500000000000000000 ETH
ETH 储备: 10.000000000000000000 ETH
NFT 储备: 20
累计收益: 0.000000000000000000 ETH
查询交易历史...
交易历史记录数:        1
按 Enter 继续...


=== 购买 NFT 演示 ===
准备购买一个 NFT...
当前价格: 0.500000000000000000 ETH
池中有 20 个 NFT 可以购买
设置最大价格: 0.550000000000000000 ETH (10% 滑点容忍度)
检查 NFT 授权...
授权 AMM 合约转移 NFT...
✅ 授权成功
价格: 0.500000000000000000 ETH, 手续费: 0.010000000000000000 ETH, 总成本: 0.510000000000000000 ETH
尝试购买 NFT...
购买交易结果:
blockHash            0x0314ac2e6f5274fe64ff2f5ee71746a8a7770c4fbe16415430209dcc0b9c4461
blockNumber          10
contractAddress
cumulativeGasUsed    228815
effectiveGasPrice    338081735
from                 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
gasUsed              228815
logs                 [{"address":"0xe7f1725e7734ce288f8367e1bb143e90bb3f0512","topics":["0x18293afef7403d415ea6acd1a96dd0114499d21b107791adfdd73c1c4f7dabef"],"data":"0x000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000000000000000000000000000002386f26fc10000","blockHash":"0x0314ac2e6f5274fe64ff2f5ee71746a8a7770c4fbe16415430209dcc0b9c4461","blockNumber":"0xa","blockTimestamp":"0x68ebbfe5","transactionHash":"0xf532b2958c0021cb79ddcdc98d444275294a863ea3911a7ec5f0d8c4b09e7f8e","transactionIndex":"0x0","logIndex":"0x0","removed":false},{"address":"0x5fbdb2315678afecb367f032d93f642f64180aa3","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x000000000000000000000000e7f1725e7734ce288f8367e1bb143e90bb3f0512","0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266","0x0000000000000000000000000000000000000000000000000000000000000001"],"data":"0x","blockHash":"0x0314ac2e6f5274fe64ff2f5ee71746a8a7770c4fbe16415430209dcc0b9c4461","blockNumber":"0xa","blockTimestamp":"0x68ebbfe5","transactionHash":"0xf532b2958c0021cb79ddcdc98d444275294a863ea3911a7ec5f0d8c4b09e7f8e","transactionIndex":"0x0","logIndex":"0x1","removed":false},{"address":"0xe7f1725e7734ce288f8367e1bb143e90bb3f0512","topics":["0x8c68226ed6c7256cb4dc9d9d1d0d84141ffb9ff4cac6ca9fa08dc46ad0a08936","0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266"],"data":"0x000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000006f05b59d3b20000000000000000000000000000000000000000000000000000002386f26fc10000","blockHash":"0x0314ac2e6f5274fe64ff2f5ee71746a8a7770c4fbe16415430209dcc0b9c4461","blockNumber":"0xa","blockTimestamp":"0x68ebbfe5","transactionHash":"0xf532b2958c0021cb79ddcdc98d444275294a863ea3911a7ec5f0d8c4b09e7f8e","transactionIndex":"0x0","logIndex":"0x2","removed":false},{"address":"0xe7f1725e7734ce288f8367e1bb143e90bb3f0512","topics":["0x15819dd2fd9f6418b142e798d08a18d0bf06ea368f4480b7b0d3f75bd966bc48"],"data":"0x00000000000000000000000000000000000000000000000007ad362cac7e0d7900000000000000000000000000000000000000000000000091db0550cd5b00000000000000000000000000000000000000000000000000000000000000000013","blockHash":"0x0314ac2e6f5274fe64ff2f5ee71746a8a7770c4fbe16415430209dcc0b9c4461","blockNumber":"0xa","blockTimestamp":"0x68ebbfe5","transactionHash":"0xf532b2958c0021cb79ddcdc98d444275294a863ea3911a7ec5f0d8c4b09e7f8e","transactionIndex":"0x0","logIndex":"0x3","removed":false}]
logsBloom            0x00000000000400000400000000000000000000000000000000000000000000000400000000000000400000000000000010000000000000000000000000040000000000000000000000000008000000000000000000040000000000000000000000000040200000000000000100000000020000000000000000000014000000000000000000000080000000000000000000000000000000000000000200000000000000000000000000000002000000000000000000000000000000000000000000000042000000200000000000001000000000002002000000000000200040080000000000000000000000000000000000000000000000800000000000000000
root
status               1 (success)
transactionHash      0xf532b2958c0021cb79ddcdc98d444275294a863ea3911a7ec5f0d8c4b09e7f8e
transactionIndex     0
type                 2
blobGasPrice         1
blobGasUsed
to                   0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
✅ NFT 购买成功！
查询购买后的状态...
购买后 NFT 储备: 19
购买后累计收益: 0.010000000000000000 ETH

=== 购买后价格监控 ===
=== NFT DEX 价格查询 ===

合约地址: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
ETH 储备量: 9223372036854775807 wei (9.223372 ETH)
NFT 储备量: 19
当前买入价格: 553157894736842105 wei (.553157 ETH)
当前卖出价格: 525499999999999999 wei (.525499 ETH)
买入总成本: 564221052631578947 wei (.564221 ETH)
买入手续费: 11063157894736842 wei (.011063 ETH)
卖出净收入: 514990000000000000 wei (.514990 ETH)
卖出手续费: 10509999999999999 wei (.010509 ETH)

=== 池子收益信息 ===
累积交易费收益: 10000000000000000 wei (.010000 ETH)
池子 ETH 余额: 10510000000000000000 wei (10.510000 ETH)
池子 ETH 储备: 10510000000000000000 wei (9.223372 ETH)
池子 NFT 储备: 19
累计手续费收益: 10000000000000000 wei (.010000 ETH)
平均价格: .553157 ETH per NFT

=== 交易历史 ===
交易历史数据: 0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000006f05b59d3b200000000000000000000000000000000000000000000000000000000000068ebbfe5
按 Enter 继续...


=== 出售 NFT 演示 ===
准备出售刚购买的 NFT (ID: 1)...
设置最小价格: 0.450000000000000000 ETH (10% 滑点容忍度)
尝试出售 NFT...
出售交易结果: 2025-10-12T14:49:16.102750Z ERROR alloy_provider::blocks: failed to fetch block number=10 err=error sending request for url (http://localhost:8545/)

blockHash            0x5dd8dfe3b0e080f5093063f2886197136a4f23fa70e32a14d3f33846894d3577
blockNumber          11
contractAddress
cumulativeGasUsed    200132
effectiveGasPrice    296466170
from                 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
gasUsed              200132
logs                 [{"address":"0xe7f1725e7734ce288f8367e1bb143e90bb3f0512","topics":["0x18293afef7403d415ea6acd1a96dd0114499d21b107791adfdd73c1c4f7dabef"],"data":"0x000000000000000000000000000000000000000000000000002556ca1096dfff0000000000000000000000000000000000000000000000000048ddbc8057dfff","blockHash":"0x5dd8dfe3b0e080f5093063f2886197136a4f23fa70e32a14d3f33846894d3577","blockNumber":"0xb","blockTimestamp":"0x68ebbfec","transactionHash":"0xe18f321b9ed194e3a521b54c83376c27039e24fa93c3ca4cdc5678c4723c9cad","transactionIndex":"0x0","logIndex":"0x0","removed":false},{"address":"0x5fbdb2315678afecb367f032d93f642f64180aa3","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266","0x000000000000000000000000e7f1725e7734ce288f8367e1bb143e90bb3f0512","0x0000000000000000000000000000000000000000000000000000000000000001"],"data":"0x","blockHash":"0x5dd8dfe3b0e080f5093063f2886197136a4f23fa70e32a14d3f33846894d3577","blockNumber":"0xb","blockTimestamp":"0x68ebbfec","transactionHash":"0xe18f321b9ed194e3a521b54c83376c27039e24fa93c3ca4cdc5678c4723c9cad","transactionIndex":"0x0","logIndex":"0x1","removed":false},{"address":"0xe7f1725e7734ce288f8367e1bb143e90bb3f0512","topics":["0x306b3d0468e32a4a4b287be94a0ff526c42c78f7fcc5387b40c45df6b5887235","0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266"],"data":"0x0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000074af3773d77bfff000000000000000000000000000000000000000000000000002556ca1096dfff","blockHash":"0x5dd8dfe3b0e080f5093063f2886197136a4f23fa70e32a14d3f33846894d3577","blockNumber":"0xb","blockTimestamp":"0x68ebbfec","transactionHash":"0xe18f321b9ed194e3a521b54c83376c27039e24fa93c3ca4cdc5678c4723c9cad","transactionIndex":"0x0","logIndex":"0x2","removed":false},{"address":"0xe7f1725e7734ce288f8367e1bb143e90bb3f0512","topics":["0x15819dd2fd9f6418b142e798d08a18d0bf06ea368f4480b7b0d3f75bd966bc48"],"data":"0x00000000000000000000000000000000000000000000000006ef786e94d2e8000000000000000000000000000000000000000000000000008ab568a3a07a20000000000000000000000000000000000000000000000000000000000000000014","blockHash":"0x5dd8dfe3b0e080f5093063f2886197136a4f23fa70e32a14d3f33846894d3577","blockNumber":"0xb","blockTimestamp":"0x68ebbfec","transactionHash":"0xe18f321b9ed194e3a521b54c83376c27039e24fa93c3ca4cdc5678c4723c9cad","transactionIndex":"0x0","logIndex":"0x3","removed":false}]
logsBloom            0x00000000000400000400000000000000000000000000000000000000000000000000000000000000410000000000000010000000000000000000000000040000000000000000000000000008000000000000000000040000000000000000000000000040200000000000000100000000020000000000000000000014000000000000000000000080000000000000000000001000000000000000000200000000000000000000000000000002000000000000000000000000000000000000000000000042000000200000000000001000000000002002000000000000000040000000000080000000000000000000000000000000000000800000000000000000
root
status               1 (success)
transactionHash      0xe18f321b9ed194e3a521b54c83376c27039e24fa93c3ca4cdc5678c4723c9cad
transactionIndex     0
type                 2
blobGasPrice         1
blobGasUsed
to                   0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
✅ NFT 出售成功！
查询出售后的状态...
出售后 NFT 储备: 20
出售后累计收益: 0.020509999999999999 ETH

=== 出售后价格监控 ===
=== NFT DEX 价格查询 ===

合约地址: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
ETH 储备量: 9223372036854775807 wei (9.223372 ETH)
NFT 储备量: 20
当前买入价格: 499750500000000000 wei (.499750 ETH)
当前卖出价格: 475952857142857142 wei (.475952 ETH)
买入总成本: 509745510000000000 wei (.509745 ETH)
买入手续费: 9995010000000000 wei (.009995 ETH)
卖出净收入: 466433800000000000 wei (.466433 ETH)
卖出手续费: 9519057142857142 wei (.009519 ETH)

=== 池子收益信息 ===
累积交易费收益: 20509999999999999 wei (.020509 ETH)
池子 ETH 余额: 9995010000000000000 wei (9.995010 ETH)
池子 ETH 储备: 9995010000000000000 wei (9.223372 ETH)
池子 NFT 储备: 20
累计手续费收益: 20509999999999999 wei (.020509 ETH)
平均价格: .499750 ETH per NFT

=== 交易历史 ===
交易历史数据: 0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000006f05b59d3b200000000000000000000000000000000000000000000000000000000000068ebbfe5000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb922660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000074af3773d77bfff0000000000000000000000000000000000000000000000000000000068ebbfec
按 Enter 继续...

=== 步骤 6: 池子管理演示 ===
池子管理功能演示...
当前 AMM 池子信息:
池子状态: 正常运行
池子所有者: 0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266
LP Token 合约: 0x000000000000000000000000cafac3dd18ac6c6e92c921884f9e4176737c052c
LP Token 总供应量: 0
累计收益: 0.020509999999999999 ETH
按 Enter 继续...

=== 演示总结 ===

本次演示展示了以下功能:
✅ 启动本地 Anvil 节点
✅ 部署 NFT 和 AMM 合约
✅ 查询合约信息
✅ 价格监控功能
✅ 交易查询功能

部署的合约:
NFT: 0x5FbDB2315678afecb367f032d93F642f64180aa3, AMM: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
按 Enter 继续...
